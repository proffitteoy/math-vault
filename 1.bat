@echo off
REM =================================================================
REM 确保 CMD 窗口正确显示 UTF-8 编码的中文
chcp 65001 >nul
setlocal

echo.
echo =================================================================
echo 欢迎使用 Quartz 笔记部署脚本
echo =================================================================
echo.

REM -----------------------------------------------------------------
REM 1. 切换目录并获取提交信息
REM -----------------------------------------------------------------
cd /d "%~dp0"
echo 当前工作目录: %cd%
echo.

set /p commit_msg="请输入你的 Git 提交信息: "
echo.

REM -----------------------------------------------------------------
REM 2. 执行 Git ADD
REM -----------------------------------------------------------------
echo 正在执行: git add .
git add .
if errorlevel 1 (
    echo.
    echo 错误: git add 失败。
    goto :end
)
echo Git Add 完成
echo.

REM -----------------------------------------------------------------
REM 3. 执行 Git COMMIT
REM -----------------------------------------------------------------
echo 正在执行: git commit -m "%commit_msg%"
git commit -m "%commit_msg%"
set commit_success=!errorlevel!

if %commit_success% neq 0 (
    echo.
    echo 警告: git commit 失败。
    echo 正在尝试推送，以防上次的本地提交尚未推送...
    goto :push
) else (
    echo Git Commit 完成
    echo.
)

REM -----------------------------------------------------------------
REM 4. 执行 Git PUSH
REM -----------------------------------------------------------------
:push
echo 正在执行: git push origin main
git push origin main
if errorlevel 1 (
    echo.
    echo =================================================================
    echo ❌ 致命错误: git push 失败。
    echo 请检查您的网络连接或Git认证信息。
    echo =================================================================
) else (
    echo.
    echo =================================================================
    echo ✅ 部署触发成功!
    echo 网站将在 GitHub Actions 运行完成后自动更新。
    echo =================================================================
)

:end
echo.
pause
endlocal